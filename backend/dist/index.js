(()=>{"use strict";var e={703:e=>{function t(e,n,r,o){this.message=e,this.expected=n,this.found=r,this.location=o,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,t)}!function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}(t,Error),t.buildMessage=function(e,t){var n={literal:function(e){return'"'+o(e.text)+'"'},class:function(e){var t,n="";for(t=0;t<e.parts.length;t++)n+=e.parts[t]instanceof Array?a(e.parts[t][0])+"-"+a(e.parts[t][1]):a(e.parts[t]);return"["+(e.inverted?"^":"")+n+"]"},any:function(e){return"any character"},end:function(e){return"end of input"},other:function(e){return e.description}};function r(e){return e.charCodeAt(0).toString(16).toUpperCase()}function o(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+r(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+r(e)}))}function a(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+r(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+r(e)}))}return"Expected "+function(e){var t,r,o,a=new Array(e.length);for(t=0;t<e.length;t++)a[t]=(o=e[t],n[o.type](o));if(a.sort(),a.length>0){for(t=1,r=1;t<a.length;t++)a[t-1]!==a[t]&&(a[r]=a[t],r++);a.length=r}switch(a.length){case 1:return a[0];case 2:return a[0]+" or "+a[1];default:return a.slice(0,-1).join(", ")+", or "+a[a.length-1]}}(e)+" but "+function(e){return e?'"'+o(e)+'"':"end of input"}(t)+" found."},e.exports={SyntaxError:t,parse:function(e,n){n=void 0!==n?n:{};var r,o,a,i,c={},s={rake:L},l=L,u=C(":",!1),d=C(",",!1),h=C("0",!1),p=C("1",!1),f=C("2",!1),g=C("3",!1),v=C("4",!1),y=C("5",!1),m=C("6",!1),x=C("7",!1),b=C("8",!1),w=C("9",!1),k=0,E=[{line:1,column:1}],A=0,B=[];if("startRule"in n){if(!(n.startRule in s))throw new Error("Can't start parsing from rule \""+n.startRule+'".');l=s[n.startRule]}function C(e,t){return{type:"literal",text:e,ignoreCase:t}}function M(t){var n,r=E[t];if(r)return r;for(n=t-1;!E[n];)n--;for(r={line:(r=E[n]).line,column:r.column};n<t;)10===e.charCodeAt(n)?(r.line++,r.column=1):r.column++,n++;return E[t]=r,r}function P(e,t){var n=M(e),r=M(t);return{start:{offset:e,line:n.line,column:n.column},end:{offset:t,line:r.line,column:r.column}}}function I(e){k<A||(k>A&&(A=k,B=[]),B.push(e))}function L(){var t,n,r,o;return t=k,(n=_())!==c?(58===e.charCodeAt(k)?(r=":",k++):(r=c,I(u)),r!==c&&(o=z())!==c?t=n=function(e,t){return{origin:e,spacing:t.reverse()}}(n,o):(k=t,t=c)):(k=t,t=c),t===c&&(t=k,(n=z())!==c&&(n={origin:0,spacing:n.reverse()}),t=n),t}function z(){var t,n,r,o,a,i;return t=k,(n=S())!==c?(44===e.charCodeAt(k)?(r=",",k++):(r=c,I(d)),r!==c&&(o=z())!==c?(a=n,(i=o).push(a),t=n=i):(k=t,t=c)):(k=t,t=c),t===c&&(t=k,(n=S())!==c&&(n=function(e){return[parseInt(e)]}(n)),t=n),t}function _(){var e,t;for(k,e=[],t=N();t!==c;)e.push(t),t=N();return e!==c&&(e=parseInt(e.join(""))),e}function S(){return _()}function N(){var t;return 48===e.charCodeAt(k)?(t="0",k++):(t=c,I(h)),t===c&&(t=function(){var t;return 49===e.charCodeAt(k)?(t="1",k++):(t=c,I(p)),t===c&&(50===e.charCodeAt(k)?(t="2",k++):(t=c,I(f)),t===c&&(51===e.charCodeAt(k)?(t="3",k++):(t=c,I(g)),t===c&&(52===e.charCodeAt(k)?(t="4",k++):(t=c,I(v)),t===c&&(53===e.charCodeAt(k)?(t="5",k++):(t=c,I(y)),t===c&&(54===e.charCodeAt(k)?(t="6",k++):(t=c,I(m)),t===c&&(55===e.charCodeAt(k)?(t="7",k++):(t=c,I(x)),t===c&&(56===e.charCodeAt(k)?(t="8",k++):(t=c,I(b)),t===c&&(57===e.charCodeAt(k)?(t="9",k++):(t=c,I(w)))))))))),t}()),t}if((r=l())!==c&&k===e.length)return r;throw r!==c&&k<e.length&&I({type:"end"}),o=B,a=A<e.length?e.charAt(A):null,i=A<e.length?P(A,A+1):P(A,A),new t(t.buildMessage(o,a),o,a,i)}}}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e=n(703);const t=parseInt;window.Storage=class{constructor(){const e=window.localStorage;e.getItem("store-active")?(this.fetch=function(t){return e.getItem(t)},this.store=function(t,n){e.setItem(t,n)}):(this.fetch=function(){return null},this.store=function(){})}};class r{constructor(t){this.config=e.parse(t),this.patternWidth=this.config.spacing.reduce((function(e,t){return e+t+1}),0),this.pattern=new Array(this.patternWidth).fill(0);const n=this.pattern;var r=0;this.config.spacing.forEach((function(e){n[r]=1,r+=e})),this.createPattern=function(){},this.getNails=function(e,t){return new Array(e).map((function(e,n){const r=n-t+origin;return r>0?this.pattern[r%this.patternWidth]:r<0?this.pattern[this.patternWidth-1-r%this.patternWidth]:1}))}}}var o={};const a=["draw","rake"];var c="draw",s={},l={fn_bind:!1,dom_setup:!1,init:!1},u=2263842,d={};function h(e){return"#"==e.charAt(0)?t("0x"+e.substr(1)):(console.log(e),e.match("rgb\\((\\d*), (\\d*), (\\d*)").slice(1,4).reduce((function(e,n){return 256*e+t(n)}),0))}function p(){!l.init&&l.fn_bind&&l.dom_setup&&(l.setBGColor(h(C.image.style.backgroundColor)),console.log(h(C.image.style.backgroundColor)),d[d.active].id=l.addPallete(3),l.setActivePalette(d[d.active].id),console.log(h(d[d.active].A),h(d[d.active].B),h(d[d.active].C)),console.log(l.setColorAt(0,h(d[d.active].A)),l.setColorAt(1,h(d[d.active].B)),l.setColorAt(2,h(d[d.active].C))),l.redraw(),l.init=!0)}function f(){const{A:e,B:t,C:n}=d[d.active];d.nodes.A.style.background=e,d.nodes.B.style.background=t,d.nodes.C.style.background=n}window.Module={onRuntimeInitialized:function(){l.addPallete=Module.cwrap("addPalette","number",["number"]),l.setActivePalette=Module.cwrap("setActivePalette","number",["number"]),l.setPaletteColors=Module.cwrap("setPaletteColors","number",["number","number","number","number"]),l.setBGColor=Module.cwrap("setBGColor","void",["number"]),l.addDrop=Module.cwrap("addDrop","number",["number","number","number","number"]),l.resizeDrop=Module.cwrap("resizeDrop","number",["number","number"]),l.setColorAt=Module.cwrap("setColorAt","number",["number","number"]),l.redraw=Module.cwrap("redraw","void",[]),l.startRaking=Module.cwrap("startRaking","void",[]),l.rakeLinear=Module.cwrap("rakeLinear","boolean",["number","number","number","array"]),l.fn_bind=!0,p()}};var g={rake_dropper:{},lost_focus:function(){var e,t;e=g.menu.getBoundingClientRect(),(t=C.overlay.getBoundingClientRect()).left>e.right||t.right<e.left||t.top>e.bottom||t.bottom<e.top||(g.btn.checked=!1)}};function v(e,t){s[e]=[],Array.prototype.forEach.call(document.getElementsByClassName("state "+e),(function(t){var n=t,r=!1;do{for(n=n.nextSibling;n&&"LI"!=n.tagName;)n=n.nextSibling;r=!1,n&&a.forEach((function(e){n.classList.contains(e)&&(r=!0)}))}while(r);s[e].push({node:t,par:t.parentNode,next:n})})),s[t]&&s[t].forEach((function(e){e.par.insertBefore(e.node,e.next)})),s[e].forEach((function(e){e.node.remove()})),"rake"===t&&l.startRaking()}var y=null;function m(e){switch(e.id){case"download":!function(){const e=Module.ccall("getImage","number",[],[]),t=Module.HEAPU8[e]+1555200+40,n=Module.HEAPU8.slice(e+1,e+t),r=new Blob([n],{type:"image/x-portable-pixmap"});y||(y=document.createElement("a"),document.body.appendChild(y),y.style.display="none");const o=window.URL.createObjectURL(r);y.href=o,y.download="marebllous-image.ppm",y.click()}();break;case"color-1":u="A";break;case"color-2":u="B";break;case"color-3":u="C";break;case"color-dropper":C.tool[c]=b;break;case"color-rake":C.tool[c]=E;break;case"color-rake-displaced":E.config={w:150,h:150,of:75};break;case"color-rake-square":E.config={w:150,h:150,of:0};break;case"color-rake-custom":E.config=g.rake_dropper,g.btn.checked=!0,g.options.rake_dropper.checked=!0;break;case"color-sprinkler":C.tool[c]=w;break;case"rake-movement-linear":A.config.line=A.straight;break;case"rake-movement-wave":A.config.line=A.curve,A.config.magnitude=50,A.config.periode=200;break;case"switch-state":const t=e.parentNode.querySelector("label"),n=t.querySelector("img"),r=c;switch(c){case"draw":c="rake",n.src="icons/fast-backward-solid.svg",t.title="Go to state before first rake strike.";break;case"rake":c="draw",t.title="Start rakeing.",n.src="icons/arrow-right-solid.svg"}v(r,c)}}function x(e,t){const n=storage.fetch(t);n&&(e.value=n)}document.addEventListener("click",(function(e){var t=e.target;if("INPUT"==t.tagName&&t.attributes.type&&"radio"==t.attributes.type.nodeValue&&!t.parentNode.parentNode.classList.contains("sidebar")){m(t);const e=function(e){var t,n=e;if(n.parentNode.parentNode.classList.contains("menu"))n.parentNode.childNodes.forEach((function(e){"MENU"==e.tagName&&(t=e)}));else for(;!n.classList.contains("menu");)"MENU"==n.tagName&&(t=n),n=n.parentNode;return t}(t);o[t.attributes.name.nodeValue]==t?e&&e.querySelectorAll("li").forEach((function(e){e.classList.toggle("hide")})):(o[t.attributes.name.nodeValue]=t,e&&(e.querySelectorAll("li").forEach((function(e){e.classList.remove("hide")})),e.attributes.option&&(g.options[e.attributes.option.value].checked=!0)))}else"INPUT"==t.tagName&&t.attributes.type&&"button"==t.attributes.type.nodeValue&&m(t)})),document.addEventListener("touchstart",(function(){alert("No support for touch inputs at the moment!")})),window.storage=null,document.addEventListener("DOMContentLoaded",(function(){storage=new Storage,document.querySelectorAll('menu input[type="radio"]').forEach((function(e){e.checked?(o[e.attributes.name.nodeValue]=e,m(e)):void 0===o[e.attributes.name.nodeValue]&&(o[e.attributes.name.nodeValue]=null)})),C.image=document.getElementById("image"),C.overlay=document.getElementById("overlay"),C.overlay.addEventListener("mousedown",(function(e){!function(){const e=o.menu;if(e){const n=o[e.id];if(n){var t=n;do{t=o[t.id]}while(t);void 0===t&&(n.classList.contains("hide")||e.parentNode.querySelectorAll("li").forEach((function(e){e.classList.add("hide")})))}}}(),g.lost_focus(),C.click(e)})),C.overlay.addEventListener("mousemove",C.over),C.overlay.addEventListener("mouseup",C.up),C.overlay.addEventListener("mousedown",C.down),C.overlay.addEventListener("mouseleave",C.leave),C.overlay.addEventListener("contextmenu",(function(e){e.preventDefault()})),a.forEach((function(e){v(e,null)})),v(null,c),b.img=document.getElementById("img-color-dropper"),w.img=document.getElementById("img-color-sparkle"),document.querySelectorAll("menu.sidebar > li > div").forEach((function(e){e.style.maxHeight=e.scrollHeight})),g.options={rake_dropper:document.getElementById("sidebar-rake-dropper"),rake:document.getElementById("sidebar-rake"),pallet:document.getElementById("sidebar-pallet")};{const e="sidebar-rake-dropper-width",n=document.getElementById(e);x(n,e),g.rake_dropper.w=t(n.value),n.addEventListener("change",(n=>{g.rake_dropper.w=t(n.target.value),storage.store(e,n.target.value)})),n.addEventListener("keydown",(e=>{13==e.which&&n.blur()}))}{const e="sidebar-rake-dropper-height",n=document.getElementById(e);x(n,e),g.rake_dropper.h=t(n.value),n.addEventListener("change",(n=>{g.rake_dropper.h=t(n.target.value),storage.store(e,n.target.value)})),n.addEventListener("keydown",(e=>{13==e.which&&n.blur()}))}{const e="sidebar-rake-dropper-offset",n=document.getElementById(e);x(n,e),g.rake_dropper.of=t(n.value),n.addEventListener("change",(n=>{g.rake_dropper.of=t(n.target.value),storage.store(e,n.target.value)})),n.addEventListener("keydown",(e=>{13==e.which&&n.blur()}))}g.btn=document.getElementById("sidebar-btn"),g.menu=document.querySelector("menu.sidebar");{const e="sidebar-pallet-active-pallet",t=document.getElementById(e);x(t,e),d.active=t.value,t.addEventListener("change",(n=>{d.active=t.value,storage.store(e,t.value),void 0===d[d.active]?(d[d.active]={id:l.addPallete(3),A:null,B:null,C:null},l.setActivePalette(d[d.active].id)):l.setActivePalette(d[d.active].id);var{A:r,B:o,C:a}=d[d.active];x(d.inputs.A,d.active+"sidebar-pallet-color-1"),r=d.inputs.A.value,x(d.inputs.B,d.active+"sidebar-pallet-color-2"),o=d.inputs.B.value,x(d.inputs.C,d.active+"sidebar-pallet-color-3"),a=d.inputs.C.value,l.setPaletteColors(h(r),h(o),h(a)),l.redraw(),f()})),void 0===d[d.active]&&(d[d.active]={A:"black",B:"black",C:"black"}),d.inputs={}}{const e="sidebar-pallet-color-1",t=document.getElementById(e),n=function(){return d.active+e};x(t,n()),d[d.active].A=t.value,t.addEventListener("change",(e=>{d[d.active].A=t.value,storage.store(n(),t.value),l.setColorAt(0,h(t.value)),l.redraw(),f()})),d.inputs.A=t}{const e="sidebar-pallet-color-2",t=document.getElementById(e),n=function(){return d.active+e};x(t,n()),d[d.active].B=t.value,t.addEventListener("change",(e=>{d[d.active].B=t.value,storage.store(n(),t.value),l.setColorAt(1,h(t.value)),l.redraw(),f()})),d.inputs.B=t}{const e="sidebar-pallet-color-3",t=document.getElementById(e),n=function(){return d.active+e};x(t,n()),d[d.active].C=t.value,t.addEventListener("change",(e=>{d[d.active].C=t.value,storage.store(n(),t.value),l.setColorAt(2,h(t.value)),l.redraw(),f()})),d.inputs.C=t}d.nodes={A:document.getElementById("color-1").labels[0],B:document.getElementById("color-2").labels[0],C:document.getElementById("color-3").labels[0]},f();{const e="sidebar-rake-placement",t=document.getElementById(e);x(t,e),A.config.placement=new r(t.value),t.addEventListener("change",(n=>{try{A.config.placement=new r(t.value),storage.store(e,t.value)}catch(e){}})),t.addEventListener("keydown",(e=>{13==e.which&&t.blur()}))}l.dom_setup=!0,p()}));var b={circle:null,active:!1,speed:2e-4,time:null,lastdrop:null,draw:function(e,t,n){const r=C.translate({x:32,y:32});e.drawImage(b.img,t,n-r.y,r.x,r.y)},drop:function(e){if(b.active){if(b.time||(b.time=e,b.lastdrop=e),e-b.lastdrop>.05){b.lastdrop=e;const t=(e-b.time)*b.speed;l.resizeDrop(b.circle,t)}window.requestAnimationFrame(b.drop)}},down:function(e,t,n,r){var o=0;switch(u){case"A":o=0;break;case"B":o=1;break;case"C":o=2}const a={x:2*e/n-1,y:1-2*t/r,r:0};b.circle=l.addDrop(a.x,a.y,a.r,o),b.active=!0,window.requestAnimationFrame(b.drop)},up:function(){b.active=!1,b.time=null}},w={draw:function(e,t,n){const r=C.translate({x:32,y:32});e.drawImage(w.img,t-r.x/2,n-r.y/2,r.x,r.y)}};function k(e,t,n,r){var o,a,i,c=n.x,s=n.y;e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(n.x,n.y),e.stroke(),e.beginPath(),o=Math.atan2(n.y-t.y,n.x-t.x),a=r*Math.cos(o)+c,i=r*Math.sin(o)+s,e.moveTo(a,i),o+=1/3*(2*Math.PI),a=r*Math.cos(o)+c,i=r*Math.sin(o)+s,e.lineTo(a,i),o+=1/3*(2*Math.PI),a=r*Math.cos(o)+c,i=r*Math.sin(o)+s,e.lineTo(a,i),e.closePath(),e.fill()}var E={canvas:void 0,ctx:void 0,config:{w:30,h:30,of:15},init:function(){E.canvas||E.ctx||(E.canvas=document.createElement("canvas"),E.canvas.width=32,E.canvas.height=32,E.ctx=E.canvas.getContext("2d"))},setPattern:function(e){void 0===this.config_last&&(this.config_last={});var t=!1;if(Object.keys(E.config).forEach((function(e){E.config_last[e]!==E.config[e]&&(t=!0,E.config_last[e]=E.config[e])})),t){E.init();const t=e.canvas.width*this.config.w/1e3,n=e.canvas.height*this.config.h/1e3,r=e.canvas.height*this.config.of/1e3%n,o=5;this.size={x:o,y:o},this.pattern_size={x:2*t,y:n},console.log(n,r,this.pattern_size);const a={x:t,y:r};E.canvas.width=this.pattern_size.x,E.canvas.height=this.pattern_size.y,E.ctx.beginPath(),E.ctx.ellipse(this.size.x,this.size.y,this.size.x,this.size.y,0,2*Math.PI,!1),E.ctx.moveTo(this.size.x+a.x+this.size.x,this.size.y+a.y),E.ctx.ellipse(this.size.x+a.x,this.size.y+a.y,this.size.x,this.size.y,0,2*Math.PI,!1),E.ctx.stroke(),this.pattern=e.createPattern(E.canvas,"repeat")}return e.fillStyle=this.pattern,{size:this.size,pattern_size:this.pattern_size}},draw:function(e,t,n,r,o){const{size:a,pattern_size:i}=E.setPattern(e);t%=i.x,n%=i.y,e.translate(t-a.x,n-a.y),e.fillRect(-t,-n,r+t,o+n),e.setTransform(1,0,0,1,0,0)}},A={borderPoint:function(e,t,n,r,o){const a=e+t*o;return a<0?{y:0,x:(0-e)/t}:a>=r?{y:r,x:(r-e)/t}:{y:a,x:o}},lrBound:function(e,t,n,r){const o=t.x-e.x,a=(t.y-e.y)/o;if(Math.abs(a)===1/0)return{leftBound:{x:e.x,y:0},rightBound:{x:e.x,y:r}};const i=e.y-a*e.x;return{leftBound:A.borderPoint(i,a,n,r,0),rightBound:A.borderPoint(i,a,n,r,n)}},straight:function(e,t,n,r,o){const{leftBound:a,rightBound:i}=A.lrBound(t,n,r,o);e.lineWidth=.5,e.beginPath(),e.moveTo(a.x,a.y),e.lineTo(i.x,i.y),e.stroke(),e.lineWidth=2,e.strokeStyle="black",e.fillStyle="black",k(e,t,n,10)},curve:function(e,t,n,r,o){const{leftBound:a,rightBound:c}=A.lrBound(t,n,r,o);var s,l;n.x-t.x>0||n.x===t.x&&t.y<n.y?(s={x:c.x-a.x,y:c.y-a.y},l=a):(s={x:a.x-c.x,y:a.y-c.y},l=c);const u=Math.sqrt(s.x*s.x+s.y*s.y),d=Math.sqrt((t.x-l.x)**2+(t.y-l.y)**2),h=-s.y/u,p=s.x/u;e.lineWidth=.5,e.beginPath();{const t=-A.config.periode/4-20,n=Math.sin((t-d)/A.config.periode*Math.PI)*A.config.magnitude,r=l.x+t/u*s.x,o=l.y+t/u*s.y;e.moveTo(r+h*n,o+p*n)}for(i=-A.config.periode/4;i<=u+A.config.periode/4+20;i+=20){const t=l.x+i/u*s.x,n=l.y+i/u*s.y,r=Math.sin((i-d)/A.config.periode*Math.PI)*A.config.magnitude;e.lineTo(t+h*r,n+p*r)}e.stroke(),e.lineWidth=2,k(e,t,n,10)},config:{of:5,line:function(e,t,n,r,o){A.straight(e,t,n,r,o)}},init:function(){A.canvas||A.ctx||(A.canvas=document.createElement("canvas"),A.canvas.width=32,A.canvas.height=32,A.ctx=A.canvas.getContext("2d"))},setPattern:function(e){if(this.placement!==A.config.placement){this.placement=A.config.placement,A.init();const t=5;this.size={x:t,y:t},console.log(this.placement.patternWidth);const n=e.canvas.width*this.placement.patternWidth/1e3;A.canvas.width=2*this.size.x+n,A.canvas.height=2*this.size.y,A.ctx.setTransform(1,0,0,1,0,0),A.ctx.beginPath(),A.ctx.ellipse(this.size.x,this.size.y,this.size.x,this.size.y,0,2*Math.PI,!1),A.ctx.stroke(),this.pattern=e.createPattern(A.canvas,"repeat")}return e.strokeStyle=this.pattern,this.size.x},onemove:function(e,t,n,r,o){A.setPattern(e);const a={y:-n.x+t.x,x:n.y-t.y},i=A.setPattern(e),c=Math.atan2(a.y,a.x),{leftBound:s,rightBound:l}=A.lrBound(t,{x:t.x+a.x,y:t.y+a.y},r,o),u=Math.sqrt((s.x-l.x)**2+(s.y-l.y)**2),d=a.x>0||0===a.x&&a.y>0?s:l,h=-Math.sqrt((t.x-d.x)**2+(t.y-d.y)**2)%A.canvas.width;e.lineWidth=2*i,e.beginPath(),e.translate(d.x,d.y),e.rotate(c),e.translate(-i-h,-i),e.moveTo(0+h,i),e.lineTo(u+h,i),e.stroke(),e.setTransform(1,0,0,1,0,0),e.strokeStyle="black",A.config.line(e,t,n,r,o)},up:function(e,t,n,r){if(!e||!t)return;const o={x:t.x-e.x,y:t.y-e.y},a=Math.sqrt(o.x*o.x+o.y*o.y);var i;i=Math.abs(o.y)>Math.abs(o.x)?Math.floor((e.y+1)/2*1e3):Math.floor((e.x+1)/2*1e3),l.rakeLinear(o.x/n,o.y/r,a,A.config.placement.getNails(1e3,i))}};function B(e,t){const n={x:t.x-e.x,y:t.y-e.y};return Math.abs(n.x)>Math.abs(n.y)?n.y=0:n.x=0,[e,{x:e.x+n.x,y:e.y+n.y}]}var C={start:null,overlay:null,tool:{draw:b,rake:A},leave:function(){C.clear(),C.tool[c].up&&C.tool[c].up()},clear:function(){C.ctx&&C.ctx.clearRect(0,0,C.overlay.width,C.overlay.height)},scale:function(){const e=C.overlay.getBoundingClientRect();return{x:C.overlay.width/e.width,y:C.overlay.height/e.height}},translate:function(e){const t=C.scale();return{x:e.x*t.x,y:e.y*t.y}},click:function(e){},down:function(e){C.start=C.translate({x:e.offsetX,y:e.offsetY}),C.tool[c].down&&C.tool[c].down(C.start.x,C.start.y,C.overlay.width,C.overlay.height)},over:function(e){if(C.pos=C.translate({x:e.offsetX,y:e.offsetY}),C.ctx||(C.ctx=C.overlay.getContext("2d")),C.ctx){C.clear();const e=C.pos;if(null!==C.start&&C.tool[c].onemove){const[t,n]=B(C.start,e);C.tool[c].onemove(C.ctx,t,n,C.overlay.width,C.overlay.height)}else C.tool[c].draw&&C.tool[c].draw(C.ctx,e.x,e.y,C.overlay.width,C.overlay.height)}},up:function(e){if(C.tool[c].up)if(C.start&&C.pos){const[e,t]=B(C.start,C.pos);C.tool[c].up(e,t,C.overlay.width,C.overlay.height)}else C.tool[c].up();C.start=null}}})()})();